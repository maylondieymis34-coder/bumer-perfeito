<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Bumer</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='g'%3E%3Cstop offset='0' stop-color='%23FF8C42'/%3E%3Cstop offset='.5' stop-color='%23FF4D8F'/%3E%3Cstop offset='1' stop-color='%239D4EDD'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M25 50Q15 30 35 20L65 30Q85 40 75 60L50 70Q40 75 35 65Z' fill='url(%23g)'/%3E%3Ccircle cx='50' cy='50' r='10' fill='white'/%3E%3C/svg%3E">
    <style>
        /* TODO O SEU CSS ORIGINAL FICOU 100% IGUAL AQUI - N√ÉO MUDEI NADA */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100%; font-family: -apple-system, sans-serif; background: #000; position: fixed; overflow: hidden; }
        #app { width: 100%; height: 100%; background: #F5F5F5; position: relative; }
        .screen { display: none; width: 100%; height: 100%; position: absolute; flex-direction: column; background: #F5F5F5; }
        .screen.active { display: flex !important; }
        .logo { font-size: 42px; font-weight: 900; background: linear-gradient(135deg, #FF8C42, #FF4D8F, #9D4EDD); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; letter-spacing: 2px; }
        /* ... todo o resto do seu CSS continua igual ... */
        /* Eu cortei aqui pra n√£o repetir tudo, mas no seu arquivo mantenha completo */
    </style>
</head>
<body>
<div id="app">
    <!-- TODAS AS SUAS SCREENS HTML FICAM 100% IGUAIS -->
    <!-- LOGIN, RADAR, CONVERSAS, CHAT, BA√ö, PERFIL - NADA MUDOU -->

    <!-- LOGIN -->
    <div id="s-login" class="screen active">
        <div class="login">
            <div class="logo">BUMER</div>
            <p class="sub">Conex√µes reais, sem press√£o</p>
            <input type="text" id="nome" class="input" placeholder="Seu nome" autocomplete="off">
            <button class="btn" onclick="app.login()">ENTRAR</button>
        </div>
    </div>

    <!-- ... todas as outras screens exatamente como voc√™ tinha ... -->

    <!-- CHAT (√∫nica parte que usaremos realtime) -->
    <div id="s-chat" class="screen">
        <div class="chat-header">
            <button class="back" onclick="app.go('s-convs')">‚Üê</button>
            <span class="chat-nome" id="cn"></span>
            <button class="btn-bau" onclick="app.toBau()">ü™É</button>
        </div>
        <div class="msgs" id="ms"></div>
        <div class="input-bar">
            <input type="text" id="im" class="input-msg" placeholder="Mensagem...">
            <button class="send" onclick="app.send()">‚úàÔ∏è</button>
        </div>
    </div>

    <!-- ... resto das screens ... -->
</div>

<!-- FIREBASE - CDN compat (funciona em vanilla sem type="module") -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
    // COLE AQUI SUA CONFIG DO FIREBASE (pegue no console.firebase.google.com)
    const firebaseConfig = {
      apiKey: "SUA_API_KEY_AQUI",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "SEU_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    // Inicializa Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const app = {
        user: null,
        conns: [],
        curr: null,

        init() {
            const u = localStorage.getItem('bumer_user');
            if (u) {
                this.user = JSON.parse(u);
                this.load();
                this.go('s-radar');
            }
            document.getElementById('im').addEventListener('keypress', e => {
                if (e.key === 'Enter') this.send();
            });
            document.getElementById('file-input').addEventListener('change', e => this.upPhoto(e));
            setInterval(() => this.checkBau(), 60000);
        },

        // ... todas as suas fun√ß√µes originais ficam iguais at√© aqui ...

        // CHAT - modificado para realtime com Firestore
        openChat(id) {
            this.curr = this.conns.find(c => c.id === id);
            if (!this.curr) return;
            document.getElementById('cn').textContent = this.curr.nome;
            this.loadMsgs();
            this.go('s-chat');

            // Listener realtime: toda nova mensagem aparece instantaneamente
            const chatId = this.getChatId(id);
            db.collection("messages").doc(chatId).collection("msgs")
                .orderBy("t")
                .onSnapshot(snapshot => {
                    const el = document.getElementById('ms');
                    el.innerHTML = "";
                    snapshot.forEach(doc => {
                        const m = doc.data();
                        const div = document.createElement("div");
                        div.className = `msg ${m.from === this.user.id ? 'sent' : 'recv'}`;
                        div.textContent = m.txt;
                        el.appendChild(div);
                    });
                    el.scrollTop = el.scrollHeight;
                });
        },

        send() {
            const inp = document.getElementById('im');
            const txt = inp.value.trim();
            if (!txt || !this.curr) return;

            const chatId = this.getChatId(this.curr.id);
            const msgData = {
                txt,
                from: this.user.id,
                t: firebase.firestore.FieldValue.serverTimestamp()
            };

            db.collection("messages").doc(chatId).collection("msgs").add(msgData);

            inp.value = '';

            // Mant√©m a resposta fake autom√°tica (pra simular)
            setTimeout(() => {
                const rs = ['Legal! üòä','Interessante!','Concordo!','Haha üòÑ','Me conta mais!','Tamb√©m!'];
                const fakeMsg = {
                    txt: rs[Math.floor(Math.random()*rs.length)],
                    from: this.curr.id,  // simula do outro
                    t: firebase.firestore.FieldValue.serverTimestamp()
                };
                db.collection("messages").doc(chatId).collection("msgs").add(fakeMsg);
            }, 1500);
        },

        // Gera um ID √∫nico e consistente pra conversa entre dois usu√°rios
        getChatId(otherId) {
            const ids = [this.user.id, otherId].sort();
            return `chat_${ids[0]}_${ids[1]}`;
        },

        // ... todas as outras fun√ß√µes permanecem exatamente iguais ...
    };

    window.addEventListener('DOMContentLoaded', () => app.init());
</script>
</body>
</html>
